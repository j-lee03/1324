"use client";
import { useState, useEffect } from "react";
import api from "@/lib/api";
import RecordCard from "@/components/RecordCard";

export default function HomePage() {
  const [logs, setLogs] = useState([]);
  const [loading, setLoading] = useState(true);


  const [expandedId, setExpandedId] = useState<number | null>(null);

  useEffect(() => {
    const fetchRecords = async () => {
      try {
        setLoading(true);
        const res = await api.get("/records");
        setLogs(res.data);
      } catch (error) {
        console.error("ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchRecords();
  }, []);


  const handleCardClick = (id: number) => {

    setExpandedId(expandedId === id ? null : id);
  };

  if (loading) {
    return <div className="p-8 text-center">ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>;
  }

  return (
    <div className="p-8 max-w-2xl mx-auto">
      <h1 className="text-2xl font-bold mb-6">ğŸ—‚ï¸ ë©´ì ‘ ê¸°ë¡</h1>

      {logs.length === 0 ? (
        <p className="text-gray-500">
          ì•„ì§ ì €ì¥ëœ ë©´ì ‘ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. 'ì§ˆë¬¸ ìƒì„±' íƒ­ì—ì„œ ìƒˆ ë©´ì ‘ì„
          ì‹œì‘í•´ ë³´ì„¸ìš”.
        </p>
      ) : (
        <div className="space-y-4">
          {logs &&
            logs.map((log: any) => {
              if (!log) return null;

              return (
                <RecordCard
                  key={log.id}
                  record={log}
                  onClick={() => handleCardClick(log.id)}
                  // --- (ìˆ˜ì •ë¨) ---
                  // ì´ ì¹´ë“œê°€ í™•ì¥ë˜ì–´ì•¼ í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ 'isExpanded' propìœ¼ë¡œ ì „ë‹¬
                  isExpanded={expandedId === log.id}
                />
              );
            })}
        </div>
      )}
    </div>
  );
}
